<!DOCTYPE html><html lang="en" class="text-black bg-white dark:text-white dark:bg-black __variable_ac79ff __variable_8a4d12"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/ec1a1eae803b668e-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/f980ec13b5b5e554.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/blog/241019/1.jpg"/><link rel="preload" as="image" href="/images/blog/241019/2.jpg"/><link rel="preload" as="image" href="/images/blog/241019/3.jpg"/><link rel="preload" as="image" href="/images/blog/241019/4.jpg"/><link rel="preload" as="image" href="/images/blog/241019/5.jpg"/><link rel="preload" as="image" href="/images/blog/241019/6.jpg"/><link rel="stylesheet" href="/_next/static/css/5f4b86ec0fe97e1b.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/f748654d5fd56294.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-165eea145570d96f.js"/><script src="/_next/static/chunks/3471c0f1-010786d28242dc9d.js" async=""></script><script src="/_next/static/chunks/6-82f781cfdf3075d7.js" async=""></script><script src="/_next/static/chunks/main-app-e2409ad9a754ecad.js" async=""></script><script src="/_next/static/chunks/951-68001eacaacb5ddd.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-693d42848e3d3b54.js" async=""></script><title>Virtualization on my server without reinstalling OS | Brian Phan</title><meta name="description" content="This is my portfolio."/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><meta property="og:title" content="My Portfolio"/><meta property="og:description" content="This is my portfolio."/><meta property="og:url" content="https://bachsofttrick.github.io"/><meta property="og:site_name" content="My Portfolio"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="My Portfolio"/><meta name="twitter:description" content="This is my portfolio."/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="antialiased max-w-4xl mx-4 mt-8 lg:mx-auto"><main class="flex-auto min-w-0 mt-6 flex flex-col px-2 md:px-0"><aside class="-ml-[8px] mb-16 tracking-tight"><div class="lg:sticky lg:top-20"><nav class="flex flex-row items-start relative px-0 pb-0 fade md:overflow-auto scroll-pr-6 md:relative" id="nav"><div class="flex flex-row space-x-0 pr-10"><a class="transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1" href="/">home</a><a class="transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1" href="/about">about</a><a class="transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1" href="/blog">blog</a></div></nav></div></aside><section><h1 class="title font-semibold text-2xl tracking-tighter">Virtualization on my server without reinstalling OS</h1><div class="flex justify-between items-center mt-2 mb-8 text-sm"><p class="text-sm text-neutral-600 dark:text-neutral-400">Oct 19, 2024</p></div><article class="prose"><p>I always want to have a virtualization lab in my home. But I don&#x27;t want my server to fully commit to that idea.
Even though Proxmox seems like a decent OS for the job, I still pick Debian for more customization. It&#x27;s more
general-purpose compared to dedicated OS. There&#x27;s only one package that can help me realize the dream, <em>Cockpit</em>.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://cockpit-project.org/">Cockpit</a> is a web interface for managing a server. It comes with many plugins that can be
installed separately. I planned to use this for managing virtual machines, because this is the only application
with a UI to do so.</p>
<h4 id="installing"><a href="#installing" class="anchor"></a>Installing</h4>
<p>Quite easy if you&#x27;re on Debian or Ubuntu. Just type</p>
<pre><code><span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">sudo</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">apt</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">install</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">cockpit</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">cockpit</span><span class="sh__token--sign" style="color: var(--sh-sign)">-</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">machines</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span></code></pre>
<p>It will automatically install <em>Cockpit</em> along with VM plugin and other dependencies.</p>
<h4 id="quick-look"><a href="#quick-look" class="anchor"></a>Quick look</h4>
<p>Access the Cockpit UI through address <a target="_blank" rel="noopener noreferrer" href="https://your.ip:9090/">https://your.ip:9090/</a>. Your username and password
is your current account.</p>
<p><p class="flex justify-center"><img src="/images/blog/241019/1.jpg" alt=""/></p>
<p class="flex justify-center"><img src="/images/blog/241019/2.jpg" alt=""/></p></p>
<p>When you first log in, the account will be assigned <em>Limited access</em>, meaning it does not have <em>sudo</em> access.
You need to <a target="_blank" rel="noopener noreferrer" href="https://cockpit-project.org/guide/latest/privileges.html">escalate</a> to <em>Administrative access</em>
if you want more functionalities.</p>
<h4 id="creating-virtual-machines"><a href="#creating-virtual-machines" class="anchor"></a>Creating virtual machines</h4>
<p>Now, this is the hard part. I tried getting it work in the past and didn&#x27;t end well. With a new server, I intended to
do it again. Maybe this time it would work.<br/>
<!-- -->Anyway, this is not a comprehensive guide, I got it working but I will try to retrace my steps and record them for
future references.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://help.ubuntu.com/community/KVM/Installation">These parts are referenced from this article.</a><br/>
<!-- -->First, run this command to make sure VT-x (Intel) or AMD-V (AMD) is enabled in BIOS.</p>
<pre><code><span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">kvm</span><span class="sh__token--sign" style="color: var(--sh-sign)">-</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">ok</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span></code></pre>
<p>If it says <strong>INFO: /dev/kvm exists</strong> then you can proceed.<br/>
<!-- -->Second, add your own user into group <em>kvm</em> and <em>libvirt</em>.</p>
<pre><code><span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">sudo</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">adduser</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">`</span><span class="sh__token--string" style="color: var(--sh-string)">id -un</span><span class="sh__token--string" style="color: var(--sh-string)">`</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">kvm</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">sudo</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">adduser</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">`</span><span class="sh__token--string" style="color: var(--sh-string)">id -un</span><span class="sh__token--string" style="color: var(--sh-string)">`</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">libvirt</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span></code></pre>
<p>Next, I need to set up a storage pool. In Cockpit, a storage pool makes sense for hard drives, not really for disk
images, because they would ask you to show them the <em>location</em> of the ISO file, regardless of it belonging in the pool.</p>
<p><p class="flex justify-center"><img src="/images/blog/241019/3.jpg" alt=""/></p>
<p class="flex justify-center"><img src="/images/blog/241019/4.jpg" alt=""/></p>
<p class="flex justify-center"><img src="/images/blog/241019/5.jpg" alt=""/></p></p>
<p>When it asks you what type of connection, there are two types. These also show up when creating a virtual machine (VM).
The two types are system and user session:</p>
<p><strong>System</strong></p>
<ul>
<li>Ideal for server VMs</li>
<li>VM will launch with root permissions</li>
<li>Ideal networking support</li>
<li>Permissions denied for disk images in home directories</li>
</ul>
<p><strong>User session</strong></p>
<ul>
<li>Good choice for desktop virtualization</li>
<li>VM launched with unprivileged limited access, with the process and PTY owned by your user account</li>
<li>Restrictions in networking (SLIRP-based emulation) and PCI device assignment</li>
<li>Disk images can be stored in user home directory</li>
</ul>
<p>When first starting, I created like one type of pool, and another type of VM. So mix and match, which ended up with the
VM reporting error about permissions on the drive or images. Even if they both the same type (User session), I still
received some errors about permissions as well. So I consulted <a target="_blank" rel="noopener noreferrer" href="https://github.com/jedi4ever/veewee/issues/996">this GitHub issue</a>
and some solutions worked:</p>
<ul>
<li>Change /etc/libvirt/qemu.conf to make things work. Uncomment user/group to work as root.</li>
<li>Copy your ISO images and hard disks to /var/lib/libvirt/images. It only works for <em>system</em> VMs.</li>
<li>Change permission and owner:group of folder you store disks in using chmod and chown, respectively.</li>
</ul>
<p>I also adjust Spice and VNC listen address to be 0.0.0.0 by default <em>in /etc/libvirt/qemu.conf</em>, so I can connect to the VM <a target="_blank" rel="noopener noreferrer" href="https://github.com/cockpit-project/cockpit-machines/issues/73">remotely</a>.<br/>
<!-- -->One last thing. Make sure the CPU type is <strong>host-passthrough</strong> for the best performance. According to
<a target="_blank" rel="noopener noreferrer" href="https://wiki.openstack.org/wiki/LibvirtXMLCPUModel">an OpenStack post</a>, there is a difference between
host-model and host-passthrough.</p>
<p><p class="flex justify-center"><img src="/images/blog/241019/6.jpg" alt=""/></p></p></article></section><footer class="mb-16"><ul class="font-sm mt-8 flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0 dark:text-neutral-300"><li><p class=" h-7 flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100">Corvallis, Oregon, USA</p></li><li><p class=" h-7 flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100">Phone: 541-360-9231</p></li></ul><ul class="font-sm flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0 dark:text-neutral-300"><li><a class="flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100" rel="noopener noreferrer" target="_blank" href="https://github.com/bachsofttrick"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">github</p></a></li><li><a class="flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100" rel="noopener noreferrer" target="_blank" href="https://github.com/bachsofttrick/bachsofttrick.github.io"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">view source</p></a></li><li><a class="flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100" rel="noopener noreferrer" target="_blank" href="https://linkedin.com/in/brian-phan-58530b1b0/"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">linkedin</p></a></li><li><a class="flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100" rel="noopener noreferrer" target="_blank" href="mailto:xuanbach1307@gmail.com"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">email</p></a></li></ul><p class="mt-8 text-neutral-600 dark:text-neutral-300">2025</p></footer></main><script src="/_next/static/chunks/webpack-165eea145570d96f.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/ec1a1eae803b668e-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/f980ec13b5b5e554.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/5f4b86ec0fe97e1b.css\",\"style\"]\n4:HL[\"/_next/static/css/f748654d5fd56294.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"5:I[4163,[],\"\"]\n8:I[5505,[],\"\"]\na:I[8694,[],\"\"]\nb:I[7951,[\"951\",\"static/chunks/951-68001eacaacb5ddd.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-693d42848e3d3b54.js\"],\"\"]\nd:I[8233,[],\"\"]\n9:[\"slug\",\"241019\",\"d\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L5\",null,{\"buildId\":\"1BSX1_MlqXnsGeX_lcl46\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"blog\",\"241019\"],\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"241019\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"241019\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"241019\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L6\",[\"$\",\"section\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"title font-semibold text-2xl tracking-tighter\",\"children\":\"Virtualization on my server without reinstalling OS\"}],[\"$\",\"div\",null,{\"className\":\"flex justify-between items-center mt-2 mb-8 text-sm\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-sm text-neutral-600 dark:text-neutral-400\",\"children\":\"Oct 19, 2024\"}]}],[\"$\",\"article\",null,{\"className\":\"prose\",\"children\":\"$L7\"}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f748654d5fd56294.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5f4b86ec0fe97e1b.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"text-black bg-white dark:text-white dark:bg-black __variable_ac79ff __variable_8a4d12\",\"children\":[\"$\",\"body\",null,{\"className\":\"antialiased max-w-4xl mx-4 mt-8 lg:mx-auto\",\"children\":[\"$\",\"main\",null,{\"className\":\"flex-auto min-w-0 mt-6 flex flex-col px-2 md:px-0\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"-ml-[8px] mb-16 tracking-tight\",\"children\":[\"$\",\"div\",null,{\"className\":\"lg:sticky lg:top-20\",\"children\":[\"$\",\"nav\",null,{\"className\":\"flex flex-row items-start relative px-0 pb-0 fade md:overflow-auto scroll-pr-6 md:relative\",\"id\":\"nav\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-row space-x-0 pr-10\",\"children\":[[\"$\",\"$Lb\",\"/\",{\"href\":\"/\",\"className\":\"transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1\",\"children\":\"home\"}],[\"$\",\"$Lb\",\"/about\",{\"href\":\"/about\",\"className\":\"transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1\",\"children\":\"about\"}],[\"$\",\"$Lb\",\"/blog\",{\"href\":\"/blog\",\"className\":\"transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1\",\"children\":\"blog\"}]]}]}]}]}],[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"section\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-8 text-2xl font-semibold tracking-tighter\",\"children\":\"404 - Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"The page you are looking for does not exist.\"}]]}],\"notFoundStyles\":[]}],[\"$\",\"footer\",null,{\"className\":\"mb-16\",\"children\":[[\"$\",\"ul\",null,{\"className\":\"font-sm mt-8 flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0 dark:text-neutral-300\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$undefined\",[\"$\",\"p\",null,{\"className\":\" h-7 flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100\",\"children\":\"Corvallis, Oregon, USA\"}]]}],[\"$\",\"li\",null,{\"children\":[\"$undefined\",[\"$\",\"p\",null,{\"className\":\" h-7 flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100\",\"children\":\"Phone: 541-360-9231\"}]]}]]}],[\"$\",\"ul\",null,{\"className\":\"font-sm flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0 dark:text-neutral-300\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"https://github.com/bachsofttrick\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"github\"}]]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"https://github.com/bachsofttrick/bachsofttrick.github.io\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"view source\"}]]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"https://linkedin.com/in/brian-phan-58530b1b0/\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"linkedin\"}]]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"mailto:xuanbach1307@gmail.com\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"email\"}]]}]}]]}],[\"$\",\"p\",null,{\"className\":\"mt-8 text-neutral-600 dark:text-neutral-300\",\"children\":2025}]]}]]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]\n"])</script><script>self.__next_f.push([1,"f:T61f,\u003cspan class=\"sh__line\"\u003e\u003cspan class=\"sh__token--identifier\" style=\"color: var(--sh-identifier)\"\u003esudo\u003c/span\u003e\u003cspan class=\"sh__token--space\" style=\"color: var(--sh-space)\"\u003e \u003c/span\u003e\u003cspan class=\"sh__token--identifier\" style=\"color: var(--sh-identifier)\"\u003eadduser\u003c/span\u003e\u003cspan class=\"sh__token--space\" style=\"color: var(--sh-space)\"\u003e \u003c/span\u003e\u003cspan class=\"sh__token--string\" style=\"color: var(--sh-string)\"\u003e`\u003c/span\u003e\u003cspan class=\"sh__token--string\" style=\"color: var(--sh-string)\"\u003eid -un\u003c/span\u003e\u003cspan class=\"sh__token--string\" style=\"color: var(--sh-string)\"\u003e`\u003c/span\u003e\u003cspan class=\"sh__token--space\" style=\"color: var(--sh-space)\"\u003e \u003c/span\u003e\u003cspan class=\"sh__token--identifier\" style=\"color: var(--sh-identifier)\"\u003ekvm\u003c/span\u003e\u003cspan class=\"sh__token--break\" style=\"color: var(--sh-break)\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"sh__line\"\u003e\u003cspan class=\"sh__token--identifier\" style=\"color: var(--sh-identifier)\"\u003esudo\u003c/span\u003e\u003cspan class=\"sh__token--space\" style=\"color: var(--sh-space)\"\u003e \u003c/span\u003e\u003cspan class=\"sh__token--identifier\" style=\"color: var(--sh-identifier)\"\u003eadduser\u003c/span\u003e\u003cspan class=\"sh__token--space\" style=\"color: var(--sh-space)\"\u003e \u003c/span\u003e\u003cspan class=\"sh__token--string\" style=\"color: var(--sh-string)\"\u003e`\u003c/span\u003e\u003cspan class=\"sh__token--string\" style=\"color: var(--sh-string)\"\u003eid -un\u003c/span\u003e\u003cspan class=\"sh__token--string\" style=\"color: var(--sh-string)\"\u003e`\u003c/span\u003e\u003cspan class=\"sh__token--space\" style=\"color: var(--sh-space)\"\u003e \u003c/span\u003e\u003cspan class=\"sh__token--identifier\" style=\"color: var(--sh-identifier)\"\u003elibvirt\u003c/span\u003e\u003cspan class=\"sh__token--break\" style=\"color: var(--sh-break)\"\u003e\u003c/span\u003e\u003c/span\u003e"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"p\",null,{\"children\":[\"I always want to have a virtualization lab in my home. But I don't want my server to fully commit to that idea.\\nEven though Proxmox seems like a decent OS for the job, I still pick Debian for more customization. It's more\\ngeneral-purpose compared to dedicated OS. There's only one package that can help me realize the dream, \",[\"$\",\"em\",null,{\"children\":\"Cockpit\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://cockpit-project.org/\",\"children\":\"Cockpit\"}],\" is a web interface for managing a server. It comes with many plugins that can be\\ninstalled separately. I planned to use this for managing virtual machines, because this is the only application\\nwith a UI to do so.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"installing\",\"className\":\"$undefined\",\"children\":[[[\"$\",\"a\",\"link-installing\",{\"href\":\"#installing\",\"className\":\"anchor\"}]],\"Installing\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Quite easy if you're on Debian or Ubuntu. Just type\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"sh__line\\\"\u003e\u003cspan class=\\\"sh__token--identifier\\\" style=\\\"color: var(--sh-identifier)\\\"\u003esudo\u003c/span\u003e\u003cspan class=\\\"sh__token--space\\\" style=\\\"color: var(--sh-space)\\\"\u003e \u003c/span\u003e\u003cspan class=\\\"sh__token--identifier\\\" style=\\\"color: var(--sh-identifier)\\\"\u003eapt\u003c/span\u003e\u003cspan class=\\\"sh__token--space\\\" style=\\\"color: var(--sh-space)\\\"\u003e \u003c/span\u003e\u003cspan class=\\\"sh__token--identifier\\\" style=\\\"color: var(--sh-identifier)\\\"\u003einstall\u003c/span\u003e\u003cspan class=\\\"sh__token--space\\\" style=\\\"color: var(--sh-space)\\\"\u003e \u003c/span\u003e\u003cspan class=\\\"sh__token--identifier\\\" style=\\\"color: var(--sh-identifier)\\\"\u003ecockpit\u003c/span\u003e\u003cspan class=\\\"sh__token--space\\\" style=\\\"color: var(--sh-space)\\\"\u003e \u003c/span\u003e\u003cspan class=\\\"sh__token--identifier\\\" style=\\\"color: var(--sh-identifier)\\\"\u003ecockpit\u003c/span\u003e\u003cspan class=\\\"sh__token--sign\\\" style=\\\"color: var(--sh-sign)\\\"\u003e-\u003c/span\u003e\u003cspan class=\\\"sh__token--identifier\\\" style=\\\"color: var(--sh-identifier)\\\"\u003emachines\u003c/span\u003e\u003cspan class=\\\"sh__token--break\\\" style=\\\"color: var(--sh-break)\\\"\u003e\u003c/span\u003e\u003c/span\u003e\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"It will automatically install \",[\"$\",\"em\",null,{\"children\":\"Cockpit\"}],\" along with VM plugin and other dependencies.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"quick-look\",\"className\":\"$undefined\",\"children\":[[[\"$\",\"a\",\"link-quick-look\",{\"href\":\"#quick-look\",\"className\":\"anchor\"}]],\"Quick look\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Access the Cockpit UI through address \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://your.ip:9090/\",\"children\":\"https://your.ip:9090/\"}],\". Your username and password\\nis your current account.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/241019/1.jpg\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/241019/2.jpg\",\"alt\":\"\"}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When you first log in, the account will be assigned \",[\"$\",\"em\",null,{\"children\":\"Limited access\"}],\", meaning it does not have \",[\"$\",\"em\",null,{\"children\":\"sudo\"}],\" access.\\nYou need to \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://cockpit-project.org/guide/latest/privileges.html\",\"children\":\"escalate\"}],\" to \",[\"$\",\"em\",null,{\"children\":\"Administrative access\"}],\"\\nif you want more functionalities.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"creating-virtual-machines\",\"className\":\"$undefined\",\"children\":[[[\"$\",\"a\",\"link-creating-virtual-machines\",{\"href\":\"#creating-virtual-machines\",\"className\":\"anchor\"}]],\"Creating virtual machines\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Now, this is the hard part. I tried getting it work in the past and didn't end well. With a new server, I intended to\\ndo it again. Maybe this time it would work.\",[\"$\",\"br\",null,{}],\"\\n\",\"Anyway, this is not a comprehensive guide, I got it working but I will try to retrace my steps and record them for\\nfuture references.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://help.ubuntu.com/community/KVM/Installation\",\"children\":\"These parts are referenced from this article.\"}],[\"$\",\"br\",null,{}],\"\\n\",\"First, run this command to make sure VT-x (Intel) or AMD-V (AMD) is enabled in BIOS.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"sh__line\\\"\u003e\u003cspan class=\\\"sh__token--identifier\\\" style=\\\"color: var(--sh-identifier)\\\"\u003ekvm\u003c/span\u003e\u003cspan class=\\\"sh__token--sign\\\" style=\\\"color: var(--sh-sign)\\\"\u003e-\u003c/span\u003e\u003cspan class=\\\"sh__token--identifier\\\" style=\\\"color: var(--sh-identifier)\\\"\u003eok\u003c/span\u003e\u003cspan class=\\\"sh__token--break\\\" style=\\\"color: var(--sh-break)\\\"\u003e\u003c/span\u003e\u003c/span\u003e\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If it says \",[\"$\",\"strong\",null,{\"children\":\"INFO: /dev/kvm exists\"}],\" then you can proceed.\",[\"$\",\"br\",null,{}],\"\\n\",\"Second, add your own user into group \",[\"$\",\"em\",null,{\"children\":\"kvm\"}],\" and \",[\"$\",\"em\",null,{\"children\":\"libvirt\"}],\".\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$f\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Next, I need to set up a storage pool. In Cockpit, a storage pool makes sense for hard drives, not really for disk\\nimages, because they would ask you to show them the \",[\"$\",\"em\",null,{\"children\":\"location\"}],\" of the ISO file, regardless of it belonging in the pool.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/241019/3.jpg\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/241019/4.jpg\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/241019/5.jpg\",\"alt\":\"\"}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When it asks you what type of connection, there are two types. These also show up when creating a virtual machine (VM).\\nThe two types are system and user session:\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"System\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Ideal for server VMs\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"VM will launch with root permissions\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Ideal networking support\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Permissions denied for disk images in home directories\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"User session\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Good choice for desktop virtualization\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"VM launched with unprivileged limited access, with the process and PTY owned by your user account\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Restrictions in networking (SLIRP-based emulation) and PCI device assignment\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Disk images can be stored in user home directory\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When first starting, I created like one type of pool, and another type of VM. So mix and match, which ended up with the\\nVM reporting error about permissions on the drive or images. Even if they both the same type (User session), I still\\nreceived some errors about permissions as well. So I consulted \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/jedi4ever/veewee/issues/996\",\"children\":\"this GitHub issue\"}],\"\\nand some solutions worked:\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Change /etc/libvirt/qemu.conf to make things work. Uncomment user/group to work as root.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Copy your ISO images and hard disks to /var/lib/libvirt/images. It only works for \",[\"$\",\"em\",null,{\"children\":\"system\"}],\" VMs.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Change permission and owner:group of folder you store disks in using chmod and chown, respectively.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"I also adjust Spice and VNC listen address to be 0.0.0.0 by default \",[\"$\",\"em\",null,{\"children\":\"in /etc/libvirt/qemu.conf\"}],\", so I can connect to the VM \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/cockpit-project/cockpit-machines/issues/73\",\"children\":\"remotely\"}],\".\",[\"$\",\"br\",null,{}],\"\\n\",\"One last thing. Make sure the CPU type is \",[\"$\",\"strong\",null,{\"children\":\"host-passthrough\"}],\" for the best performance. According to\\n\",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://wiki.openstack.org/wiki/LibvirtXMLCPUModel\",\"children\":\"an OpenStack post\"}],\", there is a difference between\\nhost-model and host-passthrough.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"p\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/241019/6.jpg\",\"alt\":\"\"}]}]}]]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Virtualization on my server without reinstalling OS | Brian Phan\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"This is my portfolio.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:title\",\"content\":\"My Portfolio\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:description\",\"content\":\"This is my portfolio.\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:url\",\"content\":\"https://bachsofttrick.github.io\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:site_name\",\"content\":\"My Portfolio\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:title\",\"content\":\"My Portfolio\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:description\",\"content\":\"This is my portfolio.\"}],[\"$\",\"meta\",\"15\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script></body></html>