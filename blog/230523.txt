3:I[5505,[],""]
5:I[8694,[],""]
6:I[7951,["951","static/chunks/951-68001eacaacb5ddd.js","308","static/chunks/app/blog/%5Bslug%5D/page-68a8741e3efe855c.js"],""]
4:["slug","230523","d"]
0:["fIxEdNfR3gj73vkqOg7qg",[[["",{"children":["blog",{"children":[["slug","230523","d"],{"children":["__PAGE__?{\"slug\":\"230523\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","230523","d"],{"children":["__PAGE__",{},[["$L1",["$","section",null,{"children":[["$","h1",null,{"className":"title font-semibold text-2xl tracking-tighter","children":"Compile OpenWrt for Orange Pi R1 Plus LTS"}],["$","div",null,{"className":"flex justify-between items-center mt-2 mb-8 text-sm","children":["$","p",null,{"className":"text-sm text-neutral-600 dark:text-neutral-400","children":"May 23, 2023"}]}],["$","article",null,{"className":"prose","children":"$L2"}]]}],null],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/5c2e7a9dbf5cdffa.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","className":"text-black bg-white dark:text-white dark:bg-black __variable_ac79ff __variable_8a4d12","children":["$","body",null,{"className":"antialiased max-w-4xl mx-4 mt-8 lg:mx-auto","children":["$","main",null,{"className":"flex-auto min-w-0 mt-6 flex flex-col px-2 md:px-0","children":[["$","aside",null,{"className":"-ml-[8px] mb-16 tracking-tight","children":["$","div",null,{"className":"lg:sticky lg:top-20","children":["$","nav",null,{"className":"flex flex-row items-start relative px-0 pb-0 fade md:overflow-auto scroll-pr-6 md:relative","id":"nav","children":["$","div",null,{"className":"flex flex-row space-x-0 pr-10","children":[["$","$L6","/",{"href":"/","className":"transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1","children":"home"}],["$","$L6","/about",{"href":"/about","className":"transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1","children":"about"}],["$","$L6","/blog",{"href":"/blog","className":"transition-all hover:text-neutral-800 dark:hover:text-neutral-200 flex align-middle relative py-1 px-2 m-1","children":"blog"}]]}]}]}]}],["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","section",null,{"children":[["$","h1",null,{"className":"mb-8 text-2xl font-semibold tracking-tighter","children":"404 - Page Not Found"}],["$","p",null,{"className":"mb-4","children":"The page you are looking for does not exist."}]]}],"notFoundStyles":[]}],["$","footer",null,{"className":"mb-16","children":[["$","ul",null,{"className":"font-sm mt-8 flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0 dark:text-neutral-300","children":[["$","li",null,{"children":["$undefined",["$","p",null,{"className":" h-7 flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100","children":"Corvallis, Oregon, USA"}]]}],["$","li",null,{"children":["$undefined",["$","p",null,{"className":" h-7 flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100","children":"Phone: 541-360-9231"}]]}]]}],["$","ul",null,{"className":"font-sm flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0 dark:text-neutral-300","children":[["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100","rel":"noopener noreferrer","target":"_blank","href":"https://github.com/bachsofttrick","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"github"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100","rel":"noopener noreferrer","target":"_blank","href":"https://github.com/bachsofttrick/bachsofttrick.github.io","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"view source"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100","rel":"noopener noreferrer","target":"_blank","href":"https://linkedin.com/in/brian-phan-58530b1b0/","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"linkedin"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800 dark:hover:text-neutral-100","rel":"noopener noreferrer","target":"_blank","href":"mailto:xuanbach1307@gmail.com","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"email"}]]}]}]]}],["$","p",null,{"className":"mt-8 text-neutral-600 dark:text-neutral-300","children":2024}]]}]]}]}]}]],null],null],[null,"$L7"]]]]
2:[["$","p",null,{"children":["I recently got my hand on a new router to play with. It's an ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"http://www.orangepi.org/html/hardWare/computerAndMicrocontrollers/details/orange-pi-R1-Plus-LTS.html","children":"Orange Pi\nR1 Plus\nLTS"}],",\nan Rockchip RK3328 board with dual-gigabit Ethernet ports. The reason\nfor the ",["$","em",null,{"children":"LTS"}]," or ",["$","em",null,{"children":"Long Term Support"}]," is because of chip shortage, they\nlacked the Realtek RTL8211 chip for the WAN port, so they substituted it\nwith Motorcomm YT8531C because it was more abundant. I plan to use this\nboard as either a DNS Server to speed up domain querying in place of my\nRaspberry Pi, or as a router. There is a similar board which this one\ntakes inspiration from (including device tree source, more on that\nlater), ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://www.friendlyelec.com/index.php?route=product/product&product_id=282","children":"NanoPi\nR2S"}],".\nHowever, that board was pricier and I felt a bit adventurous that day.\nSo first off, I tried out Openwrt on this board, since it was\nrecommended by the board manufacturer."]}],"\n",["$","p",null,{"children":["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/230523/my_r1.jpg","alt":""}]}]}],"\n",["$","h4",null,{"id":"different-flavors-of-openwrt","className":"$undefined","children":[[["$","a","link-different-flavors-of-openwrt",{"href":"#different-flavors-of-openwrt","className":"anchor"}]],"Different flavors of OpenWrt"]}],"\n",["$","p",null,{"children":"When I bought this board used, they gave me a metal case, a 32GB SD card\nwith their own version of OpenWrt 21.02 installed. It was packed to the\nbrim with stuff, Docker, adblock, bandwidth monitor, wake on LAN,\ntorrent downloader, DLNA, Dynamic DNS. It wasn't for my liking since it\nslowed the OS down so I tried something else."}],"\n",["$","p",null,{"children":["Following ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://orangepi.vn/huong-dan-tai-cac-ban-openwrt-cho-orange-pi-r1-plus-lts.html","children":"this\npage"}],",\nI tried out the manufacturer's OpenWrt. Much like the previous one, it\nwas based on 21.02 but fairly minimal. A Youtube named Van Tech Corner\n",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/vantechcorner/openwrt-orangepi","children":"created his own OpenWrt\nrelease"}]," from the\n",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/orangepi-xunlong/openwrt","children":"source code provided by the\nmanufacturer"}],". You can\ncheck out the ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://www.youtube.com/watch?v=vtdBMK8Cyx0&pp=ygUMb3JhbmdlIHBpIHIx","children":"unboxing and\ntesting"}],"\nvideo,\n",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://www.youtube.com/watch?v=c7dTmngyaVM&pp=ygUKbmFub3BpIHIycw%3D%3D","children":"similar"}],"\nvideo for NanoPi R2S. The two releases differ in the number of packages\npreinstalled. I tested the Van Tech's one. It was better because of its\nslim size. But when I tried to install any package that has a kernel\ndependency, like Wireguard, 4G USB support (RNDIS), it said ",["$","em",null,{"children":"The\ninstalled version of package kernel is not compatible."}]," According to the\nOpenWrt ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://openwrt.org/faq/cannot_satisfy_dependencies","children":"page"}],",\nthese were self-compiled image, and couldn't use kernel-related packages\nfrom the official repository, but had to be either included in or built\nbeforehand and installed externally. I tried out OpenWrt official\ndownload ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://downloads.openwrt.org/","children":"page"}],", but no luck for this\nboard. NanoPi R2S did have an image, though. So I'm out of luck until\nofficial support from OpenWrt or Orange Pi, right?"]}],"\n",["$","h4",null,{"id":"a-daring-approach-compile-from-source","className":"$undefined","children":[[["$","a","link-a-daring-approach-compile-from-source",{"href":"#a-daring-approach-compile-from-source","className":"anchor"}]],"A daring approach: Compile from source"]}],"\n",["$","p",null,{"children":["Before this, I compiled Asterisk for my VOIP server experiment. It was\nthe recommended way of installing it, as the one on the Ubuntu repo\n(repository) is old. I just followed the instructions and it compiled\nand installed. Another instance is driver install. Some drivers like my\nRTL8156 2.5Gbps Ethernet USB for my server had to be compiled from\nsource because again, Debian's one was too old to support it. So I\nchecked out source code from ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/vantechcorner/openwrt-orangepi","children":"Van\nTech"}],",\nwhich is a derivative (or fork) of the source code from Orange Pi's\nOpenWrt. At first, I just randomly followed instruction, feeds update,\nfeeds install. Inside menuconfig, Global build settings, I picked\n",["$","em",null,{"children":"Select all target specific packages by default"}],", ",["$","em",null,{"children":"Select all kernel\nmodule packages by default"}],". So it took ",["$","em",null,{"children":"a few hours"}]," to either compiled\nand didn't run on the R1 Plus board, or it caught an error halfway.\nAfter a few more tries, I eventually got it compiling correctly, though\nI chose to ",["$","em",null,{"children":"make -j1"}]," because I needed to trace the error if it popped\nup."]}],"\n",["$","p",null,{"children":["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/230523/menuconfig.jpg","alt":""}]}]}],"\n",["$","p",null,{"children":["After testing the compiled image on the board to verify it running\ncorrectly, I searched Google and found ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://forum.openwrt.org/t/orange-pi-r1-plus-support/84824/246","children":"this forum post from OpenWrt and\nimage and source code from\nwalmartshopper"}],".\nIt was newer, version 22.03, and it worked using their provided image."]}],"\n",["$","p",null,{"children":"I got curious about the changes in the source code that Orange Pi made,\nso I used Visual Studio Code to look into the source. I searched for\nanything related to Orange Pi R1 Plus (LTS included) and came across\nmultiple results. I will tell you some notable ones:"}],"\n",["$","p",null,{"children":["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/230523/kernel_patch.jpg","alt":""}]}]}],"\n",["$","p",null,{"children":["- The .patch files inside ",["$","em",null,{"children":"target/linux/rockchip/patches-5.4"}]," and\n",["$","em",null,{"children":"package/boot/uboot-rockchip/patches"}],". According to\n",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://www.kernel.org/doc/html/v4.18/process/applying-patches.html","children":"kernel.org"}],",\nthese are kernel patches. This is how Orange Pi add support for their R1\nPlus (and LTS) board to OpenWrt, even though you can't find this board\non OpenWrt's download page. They patched dts files in the kernel, in\naddition to the YT8531C driver for the ethernet."]}],"\n",["$","p",null,{"children":["- ",["$","em",null,{"children":"target/linux/rockchip/image/armv8.mk"}]," shows how OpenWrt build the\nimage for the board, as well as ",["$","em",null,{"children":"package/boot/uboot-rockchip/Makefile"}],"\nfor the bootloader."]}],"\n",["$","p",null,{"children":"Note that this is an ARM processor, so the boot process is different\nthan your computer. It requires a dtb, or a device tree blob that is\ncompiled from dts - device tree source file, and its own bootloader.\nThey usually use U-Boot. To this day, Orange Pi R1 Plus (and LTS) dts\nfiles haven't been upstreamed, or merged back to the OpenWrt source. The\nLinux kernel source has upstreamed dts for R1 Plus on v6.3 and LTS on\nv6.4. Maybe in the future, as there has been several attempts at doing\nso at OpenWrt pull requests."}],"\n",["$","p",null,{"children":["Looking at other git repos like from\n",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/walmartshopper/openwrt-orangepi-r1-plus/commits/openwrt-22.03?author=walmartshopper","children":"walmartshopper"}],",\n",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/baiywt/openwrt/commits/openwrt-22.03?author=baiywt","children":"baiyut"}],"\n(who is in charge of the patches in Orange Pi OpenWrt, his own repo also\nhas OpenWrt 22.03),\n",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/immortalwrt/immortalwrt","children":"ImmortalWrt"}]," (which allows\nnon-upstreamable patches), they also applied this technique to support\nthe R1 Plus (and LTS). From ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/walmartshopper/openwrt-orangepi-r1-plus/commits/openwrt-22.03?author=walmartshopper","children":"walmartshopper's\nrepo"}],",\nI tried merging OpenWrt 22.03 current branch to his, but the number of\nconflicts is too big, I wondered if the amount of work put into keeping\nR1 Plus up-to-date with OpenWrt was this huge. It's quite amazing."]}],"\n",["$","p",null,{"children":"In the future, with the release of OpenWrt 23.05, if those customized\nrepos don't support the board, and OpenWrt doesn't support either, I\nwill see if it's possible to port the files for R1 Plus (and LTS) over."}],"\n",["$","h4",null,{"id":"note-on-using-android-tv-box-as-router","className":"$undefined","children":[[["$","a","link-note-on-using-android-tv-box-as-router",{"href":"#note-on-using-android-tv-box-as-router","className":"anchor"}]],"Note on using Android TV Box as router"]}],"\n",["$","p",null,{"children":["Before all this, I tried testing a X96 Air S905X3 4GB and Mecool M8S Pro\nW S905W 2GB with this OpenWrt implementation by\n",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/ophub/amlogic-s9xxx-openwrt","children":"ophub"}],". He used Armbian\nbootloader to boot to OpenWrt environment. One of the flaws I discovered\nafter testing ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://coreelec.org/","children":"Coreelec"}]," on the Mecool is that ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://forum.armbian.com/topic/18871-boot-from-usb-having-armbian-on-emmc/","children":"I\ncan't boot back to Armbian or OpenWrt\nanymore"}],",\ndue to Coreelec overwriting the eMMC bootloader and I don't want to\nre-flash Android on the TV Box. In fact, this was exactly why I\npurchased this Orange Pi R1 Plus LTS board. So I don't have to go\nthrough this hassle with TV Box. And in the event of Raspberry Pi\nshortage such as right now, I want to switch to alternative single board\ncomputers such as Orange Pi from now on. While support is spotty, they\noutperform the Raspberry Pi and don't ",["$","em",null,{"children":"cost an arm and a leg"}]," to buy."]}],"\n",["$","p",null,{"children":"References:"}],"\n",["$","p",null,{"children":["- ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://openwrt.org/docs/guide-developer/source-code/start","children":"OpenWrt source\ncode"}]]}],"\n",["$","p",null,{"children":["- ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://openwrt.org/docs/guide-developer/toolchain/use-buildsystem","children":"OpenWrt Build system\nusage"}]]}]]
7:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Compile OpenWrt for Orange Pi R1 Plus LTS | Brian Phan"}],["$","meta","3",{"name":"description","content":"This is my portfolio."}],["$","meta","4",{"name":"robots","content":"index, follow"}],["$","meta","5",{"name":"googlebot","content":"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"}],["$","meta","6",{"property":"og:title","content":"My Portfolio"}],["$","meta","7",{"property":"og:description","content":"This is my portfolio."}],["$","meta","8",{"property":"og:url","content":"https://bachsofttrick.github.io"}],["$","meta","9",{"property":"og:site_name","content":"My Portfolio"}],["$","meta","10",{"property":"og:locale","content":"en_US"}],["$","meta","11",{"property":"og:type","content":"website"}],["$","meta","12",{"name":"twitter:card","content":"summary"}],["$","meta","13",{"name":"twitter:title","content":"My Portfolio"}],["$","meta","14",{"name":"twitter:description","content":"This is my portfolio."}],["$","meta","15",{"name":"next-size-adjust"}]]
1:null
