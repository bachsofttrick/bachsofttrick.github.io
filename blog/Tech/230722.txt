3:I[4707,[],""]
6:I[6423,[],""]
7:I[4888,["972","static/chunks/972-d5884f09dde0387b.js","185","static/chunks/app/layout-9c3ad277717235be.js"],"GoogleAnalytics"]
8:I[2645,["972","static/chunks/972-d5884f09dde0387b.js","185","static/chunks/app/layout-9c3ad277717235be.js"],"Navbar"]
4:["category","Tech","d"]
5:["slug","230722","d"]
0:["bB_dy8pqBnRs1hZv6AeEb",[[["",{"children":["blog",{"children":[["category","Tech","d"],{"children":[["slug","230722","d"],{"children":["__PAGE__?{\"category\":\"Tech\",\"slug\":\"230722\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["category","Tech","d"],{"children":[["slug","230722","d"],{"children":["__PAGE__",{},[["$L1",["$","section",null,{"children":[["$","h1",null,{"className":"title font-semibold text-2xl tracking-tighter","children":"Cross compiling driver for Raspberry Pi"}],["$","div",null,{"className":"flex justify-between items-center mt-2 mb-8 text-sm","children":["$","p",null,{"className":"text-sm text-neutral-600","children":"Jul 22, 2023"}]}],["$","article",null,{"className":"prose","children":"$L2"}]]}],[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/587fc2319eebab18.css","precedence":"next","crossOrigin":"$undefined"}]]],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children","$5","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4d66c1a699081f75.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","className":"text-black bg-white __variable_ac79ff __variable_8a4d12","children":[["$","meta",null,{"name":"msvalidate.01","content":"D1474E050BE527719E98F0704865EEAE"}],["$","$L7",null,{"gaId":"G-N3J3E2ME0X"}],["$","body",null,{"className":"antialiased max-w-4xl mx-4 mt-8 lg:mx-auto","children":["$","main",null,{"className":"flex-auto min-w-0 mt-6 flex flex-col px-2 md:px-0","children":[["$","$L8",null,{}],["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","section",null,{"children":[["$","h1",null,{"className":"mb-8 text-2xl font-semibold tracking-tighter","children":"404 - Page Not Found"}],["$","p",null,{"className":"mb-4","children":"The page you are looking for does not exist."}]]}],"notFoundStyles":[]}],["$","footer",null,{"className":"mb-16","children":[["$","ul",null,{"className":"font-sm mt-8 flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0","children":[["$","li",null,{"children":["$undefined",["$","p",null,{"className":" h-7 flex items-center transition-all hover:text-neutral-800","children":"United States"}]]}],["$","li",null,{"children":["$undefined",["$","p",null,{"className":" h-7 flex items-center transition-all hover:text-neutral-800","children":"Phone: 541-360-9231"}]]}]]}],["$","ul",null,{"className":"font-sm flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0","children":[["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"https://github.com/bachsofttrick/","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"github"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"https://linkedin.com/in/brphan/","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"linkedin"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"mailto:xuanbach1307@gmail.com","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"email"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"https://github.com/bachsofttrick/bachsofttrick.github.io/raw/refs/heads/main/resume.docx","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"get resume"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"/rss.xml","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"rss"}]]}]}]]}],["$","p",null,{"className":"mt-8 text-neutral-600","children":2026}]]}]]}]}]]}]],null],null],["$L9",null]]]]
2:[["$","p",null,{"children":["After multiple times compiling drivers on multiple environments,\nspecifically OpenWrt, I'd decided to see if I could compile the driver\nof my wifi adapter, ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/brektrou/rtl8821CU","children":"rtl8821cu"}],", for my\nRaspberry Pi 3 from my laptop. Raspberry Pi ran on DietPi, which is\nbased on Debian."]}],"\n",["$","h4",null,{"id":"compile-on-raspberry-pi","className":"$undefined","children":[[["$","a","link-compile-on-raspberry-pi",{"href":"#compile-on-raspberry-pi","className":"anchor"}]],"Compile on Raspberry Pi"]}],"\n",["$","p",null,{"children":["First, I installed ",["$","em",null,{"children":"raspberrypi-kernel-header"}],", which is a package\ncontaining the kernel source of Raspberry Pi. Afterwards, I ran this\ncommand to compile the driver, it worked:"]}],"\n",["$","p",null,{"children":["$","em",null,{"children":"make -j4"}]}],"\n",["$","p",null,{"children":"I tried out this trick I learned from r8152 source compiling, but it\nfailed:"}],"\n",["$","p",null,{"children":["$","em",null,{"children":"make -C <kernel source> M=$(pwd) -j$(nproc)"}]}],"\n",["$","p",null,{"children":"It didn't work when I added cross compiling parameters, either:"}],"\n",["$","p",null,{"children":["$","em",null,{"children":"make ARCH=arm64 CROSS_COMPILE= -C <kernel source> M=$(pwd)\n-j$(nproc)"}]}],"\n",["$","h4",null,{"id":"compile-on-x86","className":"$undefined","children":[[["$","a","link-compile-on-x86",{"href":"#compile-on-x86","className":"anchor"}]],"Compile on x86"]}],"\n",["$","p",null,{"children":["I downloaded the ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://github.com/raspberrypi/linux","children":"Raspberry Pi Kernel Source\nCode"}]," from Github and\ninstalled the package gcc-aarch64-linux-gnu. I used the following line\nbut that didn't work:"]}],"\n",["$","p",null,{"children":["$","em",null,{"children":"make -C <kernel source> M=$(pwd) -j$(nproc)"}]}],"\n",["$","p",null,{"children":"So is the next one:"}],"\n",["$","p",null,{"children":["$","em",null,{"children":"make ARCH=arm64 CROSS_COMPILE= -C <kernel source> M=$(pwd)\n-j$(nproc)"}]}],"\n",["$","p",null,{"children":["After reading ",["$","em",null,{"children":"Makefile"}]," in the ",["$","em",null,{"children":"rtl8821cu"}]," folder and found a line at\nthe ",["$","em",null,{"children":"modules"}]," part:"]}],"\n",["$","p",null,{"children":["$","em",null,{"children":"$$(MAKE) ARCH=$(ARCH) CROSS_COMPILE=$(CROSS_COMPILE) -C $(KSRC)\nM=$(shell pwd) modules"}]}],"\n",["$","p",null,{"children":["I rechecked my command line. While ",["$","strong",null,{"children":"ARCH, CROSS_COMPILE"}]," I filled in\ncorrectly, I should be filling in ",["$","strong",null,{"children":"KSRC=<kernel source>"}]," instead of\n",["$","strong",null,{"children":"-C <kernel source>"}],". It worked afterwards:"]}],"\n",["$","p",null,{"children":["$","em",null,{"children":"make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu-\nKSRC=~/Documents/Programming/linux-rpi-6.1.y/ -j$(nproc)"}]}],"\n",["$","p",null,{"children":["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/Tech/23/230722/make1.jpg","alt":""}]}]}],"\n",["$","p",null,{"children":["However, the output told me to go to the kernel source and run ",["$","em",null,{"children":"make\noldconfig && make prepare"}],". So I did:"]}],"\n",["$","p",null,{"children":["$","em",null,{"children":"make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- oldconfig && make\nARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- prepare"}]}],"\n",["$","p",null,{"children":"It asked a ton of questions though."}],"\n",["$","p",null,{"children":["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/Tech/23/230722/make%20oldconfig.jpg","alt":""}]}]}],"\n",["$","p",null,{"children":"About to finish, it came out with this error."}],"\n",["$","p",null,{"children":["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/Tech/23/230722/make2.jpg","alt":""}]}]}],"\n",["$","p",null,{"children":["I looked into line 2501 of Makefile of the driver, it was the ",["$","em",null,{"children":"module"}],"\npart, so not the place yet. Line 1929 of Makefile of the kernel source\nshowed more promise."]}],"\n",["$","p",null,{"children":["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/Tech/23/230722/make3.jpg","alt":""}]}]}],"\n",["$","p",null,{"children":["I looked into ",["$","em",null,{"children":"Makefile.modfinal"}],". It's like the file and the error are\nboth looking for ",["$","em",null,{"children":"module.lds"}]," but it's not available in the kernel\nsource. Temporarily, I copied ",["$","em",null,{"children":"module.lds.S"}]," to ",["$","em",null,{"children":"module.lds."}]," It did\ncompile, but it didn't work on Raspberry Pi, likely because of kernel\n6.1.21 currently on Pi, compared to kernel source 6.1.35."]}],"\n",["$","h4",null,{"id":"what-happened-if-you-missed-arch-and-cross_compile","className":"$undefined","children":[[["$","a","link-what-happened-if-you-missed-arch-and-cross_compile",{"href":"#what-happened-if-you-missed-arch-and-cross_compile","className":"anchor"}]],"What happened if you missed ARCH and CROSS_COMPILE?"]}],"\n",["$","p",null,{"children":["Missing ",["$","strong",null,{"children":"ARCH"}]," came out with this error."]}],"\n",["$","p",null,{"children":["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/Tech/23/230722/missing%20arch.jpg","alt":""}]}]}],"\n",["$","p",null,{"children":["Missing ",["$","strong",null,{"children":"CROSS_COMPILE"}]," came out with this error."]}],"\n",["$","p",null,{"children":[["$","p",null,{"className":"flex justify-center","children":["$","img",null,{"src":"/images/blog/Tech/23/230722/missing%20cross%20compile.jpg","alt":""}]}],"\n",["$","strong",null,{"children":"Conclusion"}]]}],"\n",["$","p",null,{"children":"So I guess for now I just compile the driver against the source on the\ndevice then. Until I get the hang of cross-compiling."}],"\n",["$","p",null,{"children":"References:"}],"\n",["$","p",null,{"children":["- ",["$","a",null,{"target":"_blank","rel":"noopener noreferrer","href":"https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1906131"}]]}]]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Cross compiling driver for Raspberry Pi | Brian Phan"}],["$","meta","3",{"name":"description","content":"After multiple times compiling drivers on multiple environments,\nspecifically OpenWrt, I'd decided to see if I could compile the driver\nof my wifi adapter, [rtl8821cu](https://github.com/brektrou/rtl8..."}],["$","meta","4",{"name":"robots","content":"index, follow"}],["$","meta","5",{"name":"googlebot","content":"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"}],["$","meta","6",{"property":"og:title","content":"Cross compiling driver for Raspberry Pi"}],["$","meta","7",{"property":"og:description","content":"After multiple times compiling drivers on multiple environments,\nspecifically OpenWrt, I'd decided to see if I could compile the driver\nof my wifi adapter, [rtl8821cu](https://github.com/brektrou/rtl8..."}],["$","meta","8",{"property":"og:url","content":"https://bachsofttrick.github.io/blog/Tech/230722"}],["$","meta","9",{"property":"og:type","content":"article"}],["$","meta","10",{"property":"article:published_time","content":"2023-07-22"}],["$","meta","11",{"property":"article:section","content":"Tech"}],["$","meta","12",{"name":"twitter:card","content":"summary"}],["$","meta","13",{"name":"twitter:title","content":"Cross compiling driver for Raspberry Pi"}],["$","meta","14",{"name":"twitter:description","content":"After multiple times compiling drivers on multiple environments,\nspecifically OpenWrt, I'd decided to see if I could compile the driver\nof my wifi adapter, [rtl8821cu](https://github.com/brektrou/rtl8..."}],["$","meta","15",{"name":"next-size-adjust"}]]
1:null
