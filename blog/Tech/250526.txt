3:I[4707,[],""]
6:I[6423,[],""]
7:I[4888,["972","static/chunks/972-d5884f09dde0387b.js","185","static/chunks/app/layout-9c3ad277717235be.js"],"GoogleAnalytics"]
8:I[2645,["972","static/chunks/972-d5884f09dde0387b.js","185","static/chunks/app/layout-9c3ad277717235be.js"],"Navbar"]
4:["category","Tech","d"]
5:["slug","250526","d"]
0:["bB_dy8pqBnRs1hZv6AeEb",[[["",{"children":["blog",{"children":[["category","Tech","d"],{"children":[["slug","250526","d"],{"children":["__PAGE__?{\"category\":\"Tech\",\"slug\":\"250526\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["category","Tech","d"],{"children":[["slug","250526","d"],{"children":["__PAGE__",{},[["$L1",["$","section",null,{"children":[["$","h1",null,{"className":"title font-semibold text-2xl tracking-tighter","children":"Multiprocessing bug in Python"}],["$","div",null,{"className":"flex justify-between items-center mt-2 mb-8 text-sm","children":["$","p",null,{"className":"text-sm text-neutral-600","children":"May 26, 2025"}]}],["$","article",null,{"className":"prose","children":"$L2"}]]}],[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/587fc2319eebab18.css","precedence":"next","crossOrigin":"$undefined"}]]],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children","$5","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4d66c1a699081f75.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","className":"text-black bg-white __variable_ac79ff __variable_8a4d12","children":[["$","meta",null,{"name":"msvalidate.01","content":"D1474E050BE527719E98F0704865EEAE"}],["$","$L7",null,{"gaId":"G-N3J3E2ME0X"}],["$","body",null,{"className":"antialiased max-w-4xl mx-4 mt-8 lg:mx-auto","children":["$","main",null,{"className":"flex-auto min-w-0 mt-6 flex flex-col px-2 md:px-0","children":[["$","$L8",null,{}],["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","section",null,{"children":[["$","h1",null,{"className":"mb-8 text-2xl font-semibold tracking-tighter","children":"404 - Page Not Found"}],["$","p",null,{"className":"mb-4","children":"The page you are looking for does not exist."}]]}],"notFoundStyles":[]}],["$","footer",null,{"className":"mb-16","children":[["$","ul",null,{"className":"font-sm mt-8 flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0","children":[["$","li",null,{"children":["$undefined",["$","p",null,{"className":" h-7 flex items-center transition-all hover:text-neutral-800","children":"United States"}]]}],["$","li",null,{"children":["$undefined",["$","p",null,{"className":" h-7 flex items-center transition-all hover:text-neutral-800","children":"Phone: 541-360-9231"}]]}]]}],["$","ul",null,{"className":"font-sm flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0","children":[["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"https://github.com/bachsofttrick/","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"github"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"https://linkedin.com/in/brphan/","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"linkedin"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"mailto:xuanbach1307@gmail.com","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"email"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"https://github.com/bachsofttrick/bachsofttrick.github.io/raw/refs/heads/main/resume.docx","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"get resume"}]]}]}],["$","li",null,{"children":["$","a",null,{"className":"flex items-center transition-all hover:text-neutral-800","rel":"noopener noreferrer","target":"_blank","href":"/rss.xml","children":[["$","svg",null,{"width":"12","height":"12","viewBox":"0 0 12 12","fill":"none","xmlns":"http://www.w3.org/2000/svg","children":["$","path",null,{"d":"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z","fill":"currentColor"}]}],["$","p",null,{"className":"ml-2 h-7","children":"rss"}]]}]}]]}],["$","p",null,{"className":"mt-8 text-neutral-600","children":2026}]]}]]}]}]]}]],null],null],["$L9",null]]]]
2:[["$","p",null,{"children":"I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).\nThis program pits those algorithms against each other in various Reversi matches, each with different configurations\nsuch as the Minimax depths, MCTS iterations, board size."}],"\n",["$","p",null,{"children":"It's quite intriguing how a small program can grow slowly in complexity. First with about 600 lines of codes. Now,\nit's big enough I have to spilt the functions and classes to libraries in order to make it clearer to see. I also\nI also added multiprocessing support for this program, cause let me tell you, when one match could last up to 10\nhours. So long, I later added a stop early flag to break the game, and that long game was with multiprocessing.\nThe multiprocessing is to distribute the games out to many cores, so each CPU core plays one game. The reason for\nmultiprocessing and not multithreading is because this program is written in Python, thus subjected to Global\nInterpreter Lock (GIL)."}],"\n",["$","p",null,{"children":"A bug my partner found was that Python could not find WEIGHTS in MinimaxPlayer, the class for the Minimax algorithm.\nNow, this wouldn't be funny if my code didn't work on my side, but it did still work. There was no error. He said\nit only happened when he used multiprocessing mode. I also knew that he used Windows and I used Linux. So I got to\nwork. The function to import json in as weights for MinimaxPlayer was supposed to import weights in a static\nvariable for MinimaxPlayer, so that those weights can be available to any MinimaxPlayer declared."}],"\n",["$","p",null,{"children":["Normally, Python’s multiprocessing.Pool creates separate processes, which do not share memory or class-level state. In the main process, the child processes (used by starmap) won’t inherit that WEIGHTS value. But WEIGHTS is a static variable\nin MinimaxPlayer, that should mean it sticks through new processes, right? I found out that on Windows, the\nmultiprocessing module uses ",["$","strong",null,{"children":"spawn"}],". This means:"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Each subprocess starts from scratch by re-importing the module."}],"\n",["$","li",null,{"children":"Nothing from global scope (like class variables, or initialized data) is automatically inherited."}],"\n",["$","li",null,{"children":"Class-level MinimaxPlayer.WEIGHTS doesn’t exist unless explicitly initialized in each subprocess."}],"\n"]}],"\n",["$","p",null,{"children":["By contrast, on Linux/macOS, multiprocessing uses ",["$","strong",null,{"children":"fork"}],", which copies memory from the parent process, including class-level state — that’s why it “just works” there."]}],"\n",["$","p",null,{"children":"Now understanding the issue, it is easy to fix. Make WEIGHTS global in the main file, then pass it in MinimaxPlayer\nwhen creating a new object."}],"\n",["$","p",null,{"children":["This bug ",["$","strong",null,{"children":"highlights"}]," the difference in OS architecture between Windows and Unix. In ",["$","strong",null,{"children":"fork"}]," in Unix, the child process\nis a copy of the parent process (using copy-on-write), while ",["$","strong",null,{"children":"spawn"}]," in Windows means starting a fresh, clean process.\nIf my friend hadn't use Windows to test, we wouldn't have caught the bug, considering its elusiveness."]}]]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Multiprocessing bug in Python | Brian Phan"}],["$","meta","3",{"name":"description","content":"I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).\nThis program pits those algorithms against each other in various Reversi matches, each..."}],["$","meta","4",{"name":"robots","content":"index, follow"}],["$","meta","5",{"name":"googlebot","content":"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"}],["$","meta","6",{"property":"og:title","content":"Multiprocessing bug in Python"}],["$","meta","7",{"property":"og:description","content":"I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).\nThis program pits those algorithms against each other in various Reversi matches, each..."}],["$","meta","8",{"property":"og:url","content":"https://bachsofttrick.github.io/blog/Tech/250526"}],["$","meta","9",{"property":"og:type","content":"article"}],["$","meta","10",{"property":"article:published_time","content":"2025-05-26"}],["$","meta","11",{"property":"article:section","content":"Tech"}],["$","meta","12",{"name":"twitter:card","content":"summary"}],["$","meta","13",{"name":"twitter:title","content":"Multiprocessing bug in Python"}],["$","meta","14",{"name":"twitter:description","content":"I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).\nThis program pits those algorithms against each other in various Reversi matches, each..."}],["$","meta","15",{"name":"next-size-adjust"}]]
1:null
