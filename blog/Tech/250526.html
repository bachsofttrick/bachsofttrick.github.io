<!DOCTYPE html><html lang="en" class="text-black bg-white __variable_ac79ff __variable_8a4d12"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/ec1a1eae803b668e-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/f980ec13b5b5e554.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/4d66c1a699081f75.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/587fc2319eebab18.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-904fb5a61c4981e8.js"/><script src="/_next/static/chunks/fd9d1056-ec0959f0939cb609.js" async=""></script><script src="/_next/static/chunks/117-e95138054262183e.js" async=""></script><script src="/_next/static/chunks/main-app-b4a7286994ec4cca.js" async=""></script><script src="/_next/static/chunks/972-d5884f09dde0387b.js" async=""></script><script src="/_next/static/chunks/app/layout-9c3ad277717235be.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-N3J3E2ME0X" as="script"/><title>Multiprocessing bug in Python | Brian Phan</title><meta name="description" content="I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).
This program pits those algorithms against each other in various Reversi matches, each..."/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><meta property="og:title" content="Multiprocessing bug in Python"/><meta property="og:description" content="I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).
This program pits those algorithms against each other in various Reversi matches, each..."/><meta property="og:url" content="https://bachsofttrick.github.io/blog/Tech/250526"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-05-26"/><meta property="article:section" content="Tech"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Multiprocessing bug in Python"/><meta name="twitter:description" content="I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).
This program pits those algorithms against each other in various Reversi matches, each..."/><meta name="next-size-adjust"/><meta name="msvalidate.01" content="D1474E050BE527719E98F0704865EEAE"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="antialiased max-w-4xl mx-4 mt-8 lg:mx-auto"><main class="flex-auto min-w-0 mt-6 flex flex-col px-2 md:px-0"><aside class="-ml-[8px] mb-16 tracking-tight"><div class="lg:sticky lg:top-20"><nav class="flex flex-row items-start relative px-0 pb-0 fade md:overflow-auto scroll-pr-6 md:relative" id="nav"><div class="flex flex-row space-x-0 pr-10"><a class="transition-all hover:text-neutral-800 flex align-middle relative py-1 px-2 m-1" href="/">home</a><a class="transition-all hover:text-neutral-800 flex align-middle relative py-1 px-2 m-1" href="/about">about</a><a class="transition-all hover:text-neutral-800 flex align-middle relative py-1 px-2 m-1" href="/projects">projects</a><a class="transition-all hover:text-neutral-800 flex align-middle relative py-1 px-2 m-1" href="/blog">blog</a><a class="transition-all hover:text-neutral-800 flex align-middle relative py-1 px-2 m-1" href="">▷</a><audio id="audio" preload="auto" src="/music/Giornos Theme, but only the best part.m4a"></audio></div></nav></div></aside><section><h1 class="title font-semibold text-2xl tracking-tighter">Multiprocessing bug in Python</h1><div class="flex justify-between items-center mt-2 mb-8 text-sm"><p class="text-sm text-neutral-600">May 26, 2025</p></div><article class="prose"><p>I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).
This program pits those algorithms against each other in various Reversi matches, each with different configurations
such as the Minimax depths, MCTS iterations, board size.</p>
<p>It&#x27;s quite intriguing how a small program can grow slowly in complexity. First with about 600 lines of codes. Now,
it&#x27;s big enough I have to spilt the functions and classes to libraries in order to make it clearer to see. I also
I also added multiprocessing support for this program, cause let me tell you, when one match could last up to 10
hours. So long, I later added a stop early flag to break the game, and that long game was with multiprocessing.
The multiprocessing is to distribute the games out to many cores, so each CPU core plays one game. The reason for
multiprocessing and not multithreading is because this program is written in Python, thus subjected to Global
Interpreter Lock (GIL).</p>
<p>A bug my partner found was that Python could not find WEIGHTS in MinimaxPlayer, the class for the Minimax algorithm.
Now, this wouldn&#x27;t be funny if my code didn&#x27;t work on my side, but it did still work. There was no error. He said
it only happened when he used multiprocessing mode. I also knew that he used Windows and I used Linux. So I got to
work. The function to import json in as weights for MinimaxPlayer was supposed to import weights in a static
variable for MinimaxPlayer, so that those weights can be available to any MinimaxPlayer declared.</p>
<p>Normally, Python’s multiprocessing.Pool creates separate processes, which do not share memory or class-level state. In the main process, the child processes (used by starmap) won’t inherit that WEIGHTS value. But WEIGHTS is a static variable
in MinimaxPlayer, that should mean it sticks through new processes, right? I found out that on Windows, the
multiprocessing module uses <strong>spawn</strong>. This means:</p>
<ul>
<li>Each subprocess starts from scratch by re-importing the module.</li>
<li>Nothing from global scope (like class variables, or initialized data) is automatically inherited.</li>
<li>Class-level MinimaxPlayer.WEIGHTS doesn’t exist unless explicitly initialized in each subprocess.</li>
</ul>
<p>By contrast, on Linux/macOS, multiprocessing uses <strong>fork</strong>, which copies memory from the parent process, including class-level state — that’s why it “just works” there.</p>
<p>Now understanding the issue, it is easy to fix. Make WEIGHTS global in the main file, then pass it in MinimaxPlayer
when creating a new object.</p>
<p>This bug <strong>highlights</strong> the difference in OS architecture between Windows and Unix. In <strong>fork</strong> in Unix, the child process
is a copy of the parent process (using copy-on-write), while <strong>spawn</strong> in Windows means starting a fresh, clean process.
If my friend hadn&#x27;t use Windows to test, we wouldn&#x27;t have caught the bug, considering its elusiveness.</p></article></section><footer class="mb-16"><ul class="font-sm mt-8 flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0"><li><p class=" h-7 flex items-center transition-all hover:text-neutral-800">United States</p></li><li><p class=" h-7 flex items-center transition-all hover:text-neutral-800">Phone: 541-360-9231</p></li></ul><ul class="font-sm flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0"><li><a class="flex items-center transition-all hover:text-neutral-800" rel="noopener noreferrer" target="_blank" href="https://github.com/bachsofttrick/"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">github</p></a></li><li><a class="flex items-center transition-all hover:text-neutral-800" rel="noopener noreferrer" target="_blank" href="https://linkedin.com/in/brphan/"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">linkedin</p></a></li><li><a class="flex items-center transition-all hover:text-neutral-800" rel="noopener noreferrer" target="_blank" href="mailto:xuanbach1307@gmail.com"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">email</p></a></li><li><a class="flex items-center transition-all hover:text-neutral-800" rel="noopener noreferrer" target="_blank" href="https://github.com/bachsofttrick/bachsofttrick.github.io/raw/refs/heads/main/resume.docx"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">get resume</p></a></li><li><a class="flex items-center transition-all hover:text-neutral-800" rel="noopener noreferrer" target="_blank" href="/rss.xml"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z" fill="currentColor"></path></svg><p class="ml-2 h-7">rss</p></a></li></ul><p class="mt-8 text-neutral-600">2026</p></footer></main><script src="/_next/static/chunks/webpack-904fb5a61c4981e8.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/ec1a1eae803b668e-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/f980ec13b5b5e554.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/4d66c1a699081f75.css\",\"style\"]\n4:HL[\"/_next/static/css/587fc2319eebab18.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"5:I[2846,[],\"\"]\n8:I[4707,[],\"\"]\nb:I[6423,[],\"\"]\nc:I[4888,[\"972\",\"static/chunks/972-d5884f09dde0387b.js\",\"185\",\"static/chunks/app/layout-9c3ad277717235be.js\"],\"GoogleAnalytics\"]\nd:I[2645,[\"972\",\"static/chunks/972-d5884f09dde0387b.js\",\"185\",\"static/chunks/app/layout-9c3ad277717235be.js\"],\"Navbar\"]\nf:I[1060,[],\"\"]\n9:[\"category\",\"Tech\",\"d\"]\na:[\"slug\",\"250526\",\"d\"]\n10:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L5\",null,{\"buildId\":\"bB_dy8pqBnRs1hZv6AeEb\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"blog\",\"Tech\",\"250526\"],\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"category\",\"Tech\",\"d\"],{\"children\":[[\"slug\",\"250526\",\"d\"],{\"children\":[\"__PAGE__?{\\\"category\\\":\\\"Tech\\\",\\\"slug\\\":\\\"250526\\\"}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"category\",\"Tech\",\"d\"],{\"children\":[[\"slug\",\"250526\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L6\",[\"$\",\"section\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"title font-semibold text-2xl tracking-tighter\",\"children\":\"Multiprocessing bug in Python\"}],[\"$\",\"div\",null,{\"className\":\"flex justify-between items-center mt-2 mb-8 text-sm\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-sm text-neutral-600\",\"children\":\"May 26, 2025\"}]}],[\"$\",\"article\",null,{\"className\":\"prose\",\"children\":\"$L7\"}]]}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/587fc2319eebab18.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\",\"$a\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4d66c1a699081f75.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"text-black bg-white __variable_ac79ff __variable_8a4d12\",\"children\":[[\"$\",\"meta\",null,{\"name\":\"msvalidate.01\",\"content\":\"D1474E050BE527719E98F0704865EEAE\"}],[\"$\",\"$Lc\",null,{\"gaId\":\"G-N3J3E2ME0X\"}],[\"$\",\"body\",null,{\"className\":\"antialiased max-w-4xl mx-4 mt-8 lg:mx-auto\",\"children\":[\"$\",\"main\",null,{\"className\":\"flex-auto min-w-0 mt-6 flex flex-col px-2 md:px-0\",\"children\":[[\"$\",\"$Ld\",null,{}],[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"section\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-8 text-2xl font-semibold tracking-tighter\",\"children\":\"404 - Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"The page you are looking for does not exist.\"}]]}],\"notFoundStyles\":[]}],[\"$\",\"footer\",null,{\"className\":\"mb-16\",\"children\":[[\"$\",\"ul\",null,{\"className\":\"font-sm mt-8 flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$undefined\",[\"$\",\"p\",null,{\"className\":\" h-7 flex items-center transition-all hover:text-neutral-800\",\"children\":\"United States\"}]]}],[\"$\",\"li\",null,{\"children\":[\"$undefined\",[\"$\",\"p\",null,{\"className\":\" h-7 flex items-center transition-all hover:text-neutral-800\",\"children\":\"Phone: 541-360-9231\"}]]}]]}],[\"$\",\"ul\",null,{\"className\":\"font-sm flex flex-col space-x-0 space-y-2 text-neutral-600 md:flex-row md:space-x-4 md:space-y-0\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"https://github.com/bachsofttrick/\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"github\"}]]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"https://linkedin.com/in/brphan/\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"linkedin\"}]]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"mailto:xuanbach1307@gmail.com\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"email\"}]]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"https://github.com/bachsofttrick/bachsofttrick.github.io/raw/refs/heads/main/resume.docx\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"get resume\"}]]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"flex items-center transition-all hover:text-neutral-800\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"href\":\"/rss.xml\",\"children\":[[\"$\",\"svg\",null,{\"width\":\"12\",\"height\":\"12\",\"viewBox\":\"0 0 12 12\",\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[\"$\",\"path\",null,{\"d\":\"M2.07102 11.3494L0.963068 10.2415L9.2017 1.98864H2.83807L2.85227 0.454545H11.8438V9.46023H10.2955L10.3097 3.09659L2.07102 11.3494Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"p\",null,{\"className\":\"ml-2 h-7\",\"children\":\"rss\"}]]}]}]]}],[\"$\",\"p\",null,{\"className\":\"mt-8 text-neutral-600\",\"children\":2026}]]}]]}]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"p\",null,{\"children\":\"I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).\\nThis program pits those algorithms against each other in various Reversi matches, each with different configurations\\nsuch as the Minimax depths, MCTS iterations, board size.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"It's quite intriguing how a small program can grow slowly in complexity. First with about 600 lines of codes. Now,\\nit's big enough I have to spilt the functions and classes to libraries in order to make it clearer to see. I also\\nI also added multiprocessing support for this program, cause let me tell you, when one match could last up to 10\\nhours. So long, I later added a stop early flag to break the game, and that long game was with multiprocessing.\\nThe multiprocessing is to distribute the games out to many cores, so each CPU core plays one game. The reason for\\nmultiprocessing and not multithreading is because this program is written in Python, thus subjected to Global\\nInterpreter Lock (GIL).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A bug my partner found was that Python could not find WEIGHTS in MinimaxPlayer, the class for the Minimax algorithm.\\nNow, this wouldn't be funny if my code didn't work on my side, but it did still work. There was no error. He said\\nit only happened when he used multiprocessing mode. I also knew that he used Windows and I used Linux. So I got to\\nwork. The function to import json in as weights for MinimaxPlayer was supposed to import weights in a static\\nvariable for MinimaxPlayer, so that those weights can be available to any MinimaxPlayer declared.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Normally, Python’s multiprocessing.Pool creates separate processes, which do not share memory or class-level state. In the main process, the child processes (used by starmap) won’t inherit that WEIGHTS value. But WEIGHTS is a static variable\\nin MinimaxPlayer, that should mean it sticks through new processes, right? I found out that on Windows, the\\nmultiprocessing module uses \",[\"$\",\"strong\",null,{\"children\":\"spawn\"}],\". This means:\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Each subprocess starts from scratch by re-importing the module.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Nothing from global scope (like class variables, or initialized data) is automatically inherited.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Class-level MinimaxPlayer.WEIGHTS doesn’t exist unless explicitly initialized in each subprocess.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"By contrast, on Linux/macOS, multiprocessing uses \",[\"$\",\"strong\",null,{\"children\":\"fork\"}],\", which copies memory from the parent process, including class-level state — that’s why it “just works” there.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Now understanding the issue, it is easy to fix. Make WEIGHTS global in the main file, then pass it in MinimaxPlayer\\nwhen creating a new object.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This bug \",[\"$\",\"strong\",null,{\"children\":\"highlights\"}],\" the difference in OS architecture between Windows and Unix. In \",[\"$\",\"strong\",null,{\"children\":\"fork\"}],\" in Unix, the child process\\nis a copy of the parent process (using copy-on-write), while \",[\"$\",\"strong\",null,{\"children\":\"spawn\"}],\" in Windows means starting a fresh, clean process.\\nIf my friend hadn't use Windows to test, we wouldn't have caught the bug, considering its elusiveness.\"]}]]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Multiprocessing bug in Python | Brian Phan\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).\\nThis program pits those algorithms against each other in various Reversi matches, each...\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:title\",\"content\":\"Multiprocessing bug in Python\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:description\",\"content\":\"I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).\\nThis program pits those algorithms against each other in various Reversi matches, each...\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:url\",\"content\":\"https://bachsofttrick.github.io/blog/Tech/250526\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"10\",{\"property\":\"article:published_time\",\"content\":\"2025-05-26\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:section\",\"content\":\"Tech\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:title\",\"content\":\"Multiprocessing bug in Python\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:description\",\"content\":\"I have been building a program that play Reversi using two algorithm: Minimax and Monte Carlo Tree Search (MCTS).\\nThis program pits those algorithms against each other in various Reversi matches, each...\"}],[\"$\",\"meta\",\"15\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script></body></html>